# üìñ Biblia - Telegram Bot Project

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö Telegram –±–æ—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–µ–π—Å–∫–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.

## ü§ñ –ë–æ—Ç—ã

### User Bot - –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ —Å OpenAI Assistant
  - `/more` - 13 —Ç–µ–º –∏–∑ –ü–∏—Å–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ò–ò
  - `/support` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  - `/mytickets` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤
  - `/affiliate` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### Admin Bot - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
  - `/stats` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
  - `/token_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ OpenAI
  - `/token_leaderboard` - –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  
- **–†–∞–±–æ—Ç–∞ —Å —Ç–∏–∫–µ—Ç–∞–º–∏:**
  - `/tickets` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤
  - `/my_tickets` - –ú–æ–∏ –≤–∑—è—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã
  - `/viewTKT...` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ç–∞
  - –í–∑—è—Ç–∏–µ –≤ —Ä–∞–±–æ—Ç—É, –æ—Ç–≤–µ—Ç, –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–æ–≤
  
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
  - `/add_admin` - –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - `/remove_admin` - –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - `/list_admins` - –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
/app/
‚îú‚îÄ‚îÄ user_bot/          # –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot/       # –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers/   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îÇ
‚îú‚îÄ‚îÄ admin_bot/         # –ê–¥–º–∏–Ω—Å–∫–∏–π –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bot/       # –õ–æ–≥–∏–∫–∞ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îÇ
‚îú‚îÄ‚îÄ shared/            # –û–±—â–∏–µ –º–æ–¥—É–ª–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±–æ–∏–º–∏ –±–æ—Ç–∞–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ storage/       # –û–±—â–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_storage.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ticket_storage.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ content_storage.py
‚îÇ   ‚îî‚îÄ‚îÄ models/        # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ database/          # SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ 01_init_database.sql
‚îÇ   ‚îú‚îÄ‚îÄ 02_create_tables.sql
‚îÇ   ‚îú‚îÄ‚îÄ 03_insert_initial_data.sql
‚îÇ   ‚îî‚îÄ‚îÄ setup_database.sh
‚îÇ
‚îú‚îÄ‚îÄ docs/              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ supervisor_bots.conf  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supervisor
‚îî‚îÄ‚îÄ DEPLOYMENT.md      # –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11+**
- **aiogram 3.10+** - Telegram Bot Framework
- **OpenAI API** - GPT-4 –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **asyncpg** - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
- **Supervisor** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/bah677/Biblia.git
cd Biblia
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# User Bot
cd user_bot
pip install -r requirements.txt

# Admin Bot
cd ../admin_bot
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

```bash
cd database
chmod +x setup_database.sh
sudo ./setup_database.sh
sudo -u postgres psql
CREATE USER bot_user WITH PASSWORD 'your_password';
CREATE DATABASE telegram_bot OWNER bot_user;
GRANT ALL PRIVILEGES ON DATABASE telegram_bot TO bot_user;
\q

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
cd /app
python3 scripts/create_support_tickets_table.py
python3 run_migrations.py
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–æ–≤

**User Bot:**
```bash
cd user_bot
cp .env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

**Admin Bot:**
```bash
cd admin_bot
cp .env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

### 5. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Supervisor

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo cp supervisor_bots.conf /etc/supervisor/conf.d/bots.conf

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ supervisor
sudo supervisorctl reread
sudo supervisorctl update

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–æ–≤
sudo supervisorctl start bots:*
```

## üîë –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### Telegram Bot Token
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

### OpenAI API Key
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [platform.openai.com](https://platform.openai.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Keys
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### OpenAI Assistant ID
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [platform.openai.com/assistants](https://platform.openai.com/assistants)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:

- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `messages` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `support_tickets` - –¢–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `admins` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- `token_usage` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- `bot_content` - –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫
- `referrals` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

## üîÑ Workflow —Ç–∏–∫–µ—Ç–æ–≤

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç–∏–∫–µ—Ç ‚Üí User Bot
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω—Å–∫—É—é –≥—Ä—É–ø–ø—É ‚Üí Admin Bot
4. –ê–¥–º–∏–Ω –±–µ—Ä–µ—Ç –≤ —Ä–∞–±–æ—Ç—É (—Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è)
5. –ê–¥–º–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
6. –ê–¥–º–∏–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–∏–∫–µ—Ç (—Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è)

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã Supervisor

```bash
# –°—Ç–∞—Ç—É—Å
sudo supervisorctl status bots:*

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo supervisorctl restart bots:*

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo supervisorctl stop bots:*

# –õ–æ–≥–∏
tail -f /var/log/supervisor/user_bot.out.log
tail -f /var/log/supervisor/admin_bot.out.log
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–∫–µ—Ç –≤ User Bot —á–µ—Ä–µ–∑ `/support`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –≤ –∞–¥–º–∏–Ω—Å–∫—É—é –≥—Ä—É–ø–ø—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ Admin Bot –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã
4. –í–æ–∑—å–º–∏—Ç–µ —Ç–∏–∫–µ—Ç –≤ —Ä–∞–±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ `.env` —Ñ–∞–π–ª—ã –≤ Git
- –î–µ—Ä–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ —Å–µ–∫—Ä–µ—Ç–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ API –∫–ª—é—á–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –ë–î

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## üë§ –ê–≤—Ç–æ—Ä

GitHub: [@bah677](https://github.com/bah677)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/supervisor/*.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω: `service postgresql status`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å

---

‚≠ê –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–µ–∑–µ–Ω, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É!
